//
//  SMSequenceRunner.h
//  SnoizeMIDI
//
//  Created by Kurt Revis on Sat Dec 15 2001.
//  Copyright (c) 2001 __MyCompanyName__. All rights reserved.
//

#import <Foundation/Foundation.h>
#import <CoreMIDI/CoreMIDI.h>
#import <OmniFoundation/OFObject.h>
#import <SnoizeMIDI/SMMessageDestinationProtocol.h>

@class OFScheduledEvent;
@class SMSequence;

@interface SMSequenceRunner : OFObject
{
    id<SMMessageDestination> nonretainedMessageDestination;

    SMSequence *sequence;
    NSLock *sequenceLock;

    Float64 tempo;
    MIDITimeStamp tickDuration;
    NSLock *tempoLock;

    OFScheduledEvent *nextTickEvent;
    NSLock *nextTickEventLock;

    MIDITimeStamp startTimeStamp;
    MIDITimeStamp lastTickTimeStamp;

    NSMutableArray *playingNotes;

    // TODO this is only temporary--shouldn't need it
    BOOL shouldStop;
}

- (id<SMMessageDestination>)messageDestination;
- (void)setMessageDestination:(id<SMMessageDestination>)value;

- (Float64)tempo;
- (void)setTempo:(Float64)value;

- (SMSequence *)sequence;
- (void)setSequence:(SMSequence *)value;

- (void)start;
- (void)stop;
- (BOOL)isRunning;

@end
